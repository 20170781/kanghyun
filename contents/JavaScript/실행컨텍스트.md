---
date: '2021-10-11'
title: '실행 컨텍스트 | 자바스크립트'
tags: ['JavaScript', 'Study']
summary: '자바스크립트의 핵심 동작 원리를 담고 있는 실행 컨텍스트 이해하기'
thumbnail: '../thumbnails/thumbnail_실행컨텍스트.jpg'
---

실행 컨텍스트는 자바스크립트의 동작 원리를 담고 있는 핵심 개념이다.

## 1. 소스코드의 타입

ECMAScript 사양은 **소스코드**(ECMAScript code)를 4가지 타입으로 구분한다. 

4가지 타입의 소스코드는 실행 컨텍스트 생성, 소스 코드 종류에 따라 실행 컨텍스트 생성 과정과 관리 내용이 달라짐.

- **전역 코드**: 전역에 존재하는 소스코드 (함수, 클래스 등의 내부코드 포함x)
- **함수 코드**: 함수 내부에 존재하는 소스코드. (함수 내부에 중첩된 함수나 클래스 등은 포함x)
- **eval 코드**: 빌트인 전역함수 eval 함수에 인수로 전달되어 실행되는 소스코드
- **모듈 코드**: 모듈 내부에 존재하는 소스코드 (모듈 내부의 함수, 클래스 등의 내부코드는 포함x)



## 2. 소스코드의 평가와 실행

모든 소스코드는 실행에 앞서 평가 과정을 갖는다.

자바스크립트 엔진은 소스코드를 2개의 과정 "**소스코드의 평가**"와 "**소스코드의 실행**" 과정으로 나누어 처리.

- **평가 단계**: <u>**실행 컨텍스트 생성**</u>, 변수 및 함수 선언문만 먼저 실행하여 생성된 식별자를 키로 <u>실행 컨텍스트가 관리하는 **스코프**</u>에 등록
- **실행 단계(런타임)**: 선언문을 제외한 소스코드 <u>순차적</u>으로 실행.  <u>소스코드 실행에 필요한 정보</u>(변수, 함수의 참조)를 실행 컨텍스트가 관리하는 스코프에서 검색해서 취득

```js
// 평가 단계에서 선언한 변수에 대해 스코프에 등록한다.
let x;

// 실행 단계에서는 실행 컨텍스트가 관리하는 스코프에 해당 변수가 등록되어 있는지 확인한 후, 선언된 변수라면 값을 할당하고 할당 결과를 실행 컨텍스트에 등록하여 관리한다.
x = 1;
```



## 3. 실행 컨텍스트의 역할

- 선언에 의해 생성된 모든 **식별자**(변수, 함수, 클래스 등)를 스코프를 구분하여 등록하고 상태 변화(식별자에 바인딩된 값의 변화)를 지속적으로 관리할 수 있어야 한다.
- **스코프**는 중첩 관계에 의해 스코프 체인을 형성해야 한다. 즉, 스코프 체인을 통해 상위 스코프로 이동하며 식별자를 검색할 수 있어야 한다.
- 현재 실행 중인 코드의 **실행 순서**를 변경(ex. 함수 호출)할 수 있어야 하며 다시 되돌아갈 수도 있어야 한다. 

위의 모든 것을 관리하는 것이 실행 컨텍스트이다.

**실행 컨텍스트는 <u>식별자</u>를 등록하고 관리하는 <u>스코프</u>와 <u>코드 실행 순서</u> 관리를 구현한 내부 메커니즘으로, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.**

<u>식별자와 스코프</u>는 실행 컨텍스트의 **렉시컬 환경**으로 관리, <u>코드 실행 순서</u>는 **실행 컨텍스트 스택**으로 관리한다.



## 4. 실행 컨텍스트 스택 (Execution Context Stack)

소스 코드를 평가하면 함수 실행 컨텍스트를 생성한다. 이때 생성된 실행 컨텍스트는 <u>스택 자료구조</u>로 관리되는데, 이를 **실행 컨텍스트 스택**이라고 부른다.

코드를 실행하면 시간의 흐름에 따라 실행 컨텍스트 스택에 실행 컨텍스트가 추가되고 제거된다.



## 5. 렉시컬 환경 (Lexical Environment)

렉시컬 환경은 <u>식별자</u>와 <u>식별자에 바인딩된 값</u>, 그리고 상위 <u>스코프에 대한 참조</u>를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트다.

렉시컬 환경은 <u>객체 형태의 스코프</u>(전역, 함수, 블록 스코프)를 **생성**하고 **구분**하여 식별자를 등록 및 관리하는 저장소 역할을 하는 **렉시컬 스코프**의 실체다.

실행 컨텍스트는 `LexicalEnvironment` 컴포넌트와 `VariableEnvironment` 컴포넌트로 구성된다. 실행 컨텍스트 생성 초기에 두 컴포넌트는 동일한 렉시컬 환경을 참조하고, 이후에 달라진다.

렉시컬 환경은 아래 두 개의 컴포넌트로 구성된다.

- **환경 레코드 (Environment Record)**

  : 스코프에 포함된 식별자를 등록, 등록된 식별자에 바인딩된 값을 관리하는 저장소.

- **외부 렉시컬 환경에 대한 참조 (Outer Lexical Environment Reference)**

  : Outer Lexical Environment Reference는 상위 스코프(상위 코드의 렉시컬 환경)를 가리킨다. 이를 이용해 단방향 링크드 리스트인 스코프 체인 구현

정리하자면, **실행 컨텍스트**는  **`LexicalEnvironment` 컴포넌트와 `VariableEnvironment` 컴포넌트로 구성**되어 있고, 이 두 가지는 실행 컨텍스트 생성 초기에 동일한 **Lexical Environment를 참조**하며 이후에 달라진다. 그리고 **Lexical Environment**는 **스코프에 포함된 식별자를 등록 및 관리하는 Environment Record와 상위 스코프를 가리키는 Outer Lexical Environment Reference로 구성**되어 있다.



> 참고자료
>
> - [모던 자바스크립트 Deep Dive (도서)](http://www.yes24.com/Product/Goods/92742567)

